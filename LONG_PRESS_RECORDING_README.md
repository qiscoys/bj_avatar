# 长按录音功能说明

## 功能概述

数字人聊天页面已升级为长按录音模式，用户需要长按"长按说话"按钮来触发语音识别，长按期间会实时显示识别结果，松开按钮后调用AI服务。

## 主要特性

### 1. 长按触发
- 长按按钮500ms后开始录音
- 支持鼠标和触摸事件（桌面端和移动端）
- 防止长按选中文字和显示上下文菜单

### 2. 实时识别
- 使用FunASR服务进行实时语音识别
- 长按期间持续识别并更新文字预览
- 支持多端FunASR返回结果结构

### 3. 智能处理
- 长按结束后自动停止录音
- 累积长按期间的所有识别文字
- 根据最终识别结果决定是否调用AI

### 4. 用户体验
- 长按期间显示录音状态指示器
- 实时显示识别文字预览
- 未识别到内容时显示友好提示

## 使用方法

1. **进入语音聊天页面**
   - 点击主页面"数字人聊天"按钮

2. **长按录音**
   - 长按"长按说话"按钮（500ms）
   - 按钮变为红色，显示"🎤 长按录音中..."
   - 开始说话，实时显示识别结果

3. **结束录音**
   - 松开按钮
   - 系统自动处理识别结果
   - 调用AI服务生成回答

## 技术实现

### 核心类
- `SpeechRecognitionManager`: 语音识别管理器
- `UIManager`: UI交互管理器

### 关键方法
- `startLongPressRecording()`: 开始长按录音
- `endLongPressRecording()`: 结束长按录音
- `updateLongPressTextPreview()`: 更新文字预览
- `initLongPressRecording()`: 初始化长按事件

### 状态管理
- `isLongPressRecording`: 是否正在长按录音
- `longPressTextBuffer`: 长按期间识别的文字缓冲区
- `longPressTimer`: 长按定时器

## 兼容性

### 支持的事件
- 桌面端：mousedown/mouseup/mouseleave
- 移动端：touchstart/touchend/touchcancel

### 浏览器支持
- 支持触摸事件的现代浏览器
- 支持WebSocket的浏览器
- 支持录音API的浏览器

## 配置参数

- 长按触发阈值：500ms
- 录音格式：PCM
- 采样率：16kHz
- 识别服务：FunASR

## 注意事项

1. 首次使用需要授权麦克风权限
2. 长按期间请保持按钮按下状态
3. 识别结果取决于语音清晰度和环境噪音
4. 网络连接影响识别响应速度

## 故障排除

### 常见问题
1. **无法开始录音**
   - 检查麦克风权限
   - 确认浏览器支持录音API

2. **识别结果不准确**
   - 检查网络连接
   - 确认FunASR服务状态
   - 尝试在安静环境中使用

3. **长按无响应**
   - 检查按钮事件绑定
   - 确认JavaScript控制台无错误

### 调试信息
- 控制台会输出详细的调试日志
- 包括长按状态、识别结果、AI调用等信息
